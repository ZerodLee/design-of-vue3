## 响应式数据与副作用函数

```js
const obj = { text: "hello world" };

```
```js
function effect() {
  document.body.innerText = obj.text;
}
```


### 响应式数据的读取与赋值


```
flowchart LR
    effect --> 触发读取 --> 存储effect
```

```
flowchart LR
    赋值 --> 触发设置 --> 取出effect并执行
```

### 实现方式

- vue2：object.defineProperty
- vue3：proxy

```js
const bucket = new Set();

const proxyObj = new Proxy(obj, {
  get(target, key) {
    bucket.add(effect);
    return target[key];
  },
  set(target, key, newVal) {
    target[key] = newVal;
    bucket.forEach((fn) => fn());
    return true;
  },
});
```

测试代码
```js
function effect() {
  document.body.innerText = proxyObj.text;
}
effect();
setTimeout(() => {
  proxyObj.text = "changed";
}, 1000);
```